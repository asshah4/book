<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.3 Population-mean cosinor | Thoughts</title>
  <meta name="description" content="A workspace for thoughts." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="4.3 Population-mean cosinor | Thoughts" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A workspace for thoughts." />
  <meta name="github-repo" content="asshah4/thoughts" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.3 Population-mean cosinor | Thoughts" />
  
  <meta name="twitter:description" content="A workspace for thoughts." />
  

<meta name="author" content="Anish Shah" />


<meta name="date" content="2020-08-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="single-component-cosinor.html"/>
<link rel="next" href="multiple-component-cosinor.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Thoughts</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html"><i class="fa fa-check"></i><b>1.1</b> <code>R</code> and RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="git-and-github.html"><a href="git-and-github.html"><i class="fa fa-check"></i><b>1.2</b> <code>git</code> and Github</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Technical Setup</a><ul>
<li class="chapter" data-level="2.1" data-path="vim.html"><a href="vim.html"><i class="fa fa-check"></i><b>2.1</b> Vim</a></li>
<li class="chapter" data-level="2.2" data-path="mutt.html"><a href="mutt.html"><i class="fa fa-check"></i><b>2.2</b> Mutt</a></li>
<li class="chapter" data-level="2.3" data-path="building-a-cv.html"><a href="building-a-cv.html"><i class="fa fa-check"></i><b>2.3</b> Building a CV</a></li>
</ul></li>
<li class="part"><span><b>I Autonomic Regulation</b></span></li>
<li class="chapter" data-level="3" data-path="circadian.html"><a href="circadian.html"><i class="fa fa-check"></i><b>3</b> Circadian Physiology</a><ul>
<li class="chapter" data-level="3.1" data-path="chronobiology.html"><a href="chronobiology.html"><i class="fa fa-check"></i><b>3.1</b> Chronobiology</a></li>
<li class="chapter" data-level="3.2" data-path="circadian-disruption.html"><a href="circadian-disruption.html"><i class="fa fa-check"></i><b>3.2</b> Circadian Disruption</a></li>
<li class="chapter" data-level="3.3" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>3.3</b> References</a></li>
</ul></li>
<li class="part"><span><b>II Computational</b></span></li>
<li class="chapter" data-level="4" data-path="cosinor.html"><a href="cosinor.html"><i class="fa fa-check"></i><b>4</b> Cosinor Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="single-component-cosinor.html"><a href="single-component-cosinor.html"><i class="fa fa-check"></i><b>4.2</b> Single component cosinor</a></li>
<li class="chapter" data-level="4.3" data-path="population-mean-cosinor.html"><a href="population-mean-cosinor.html"><i class="fa fa-check"></i><b>4.3</b> Population-mean cosinor</a><ul>
<li class="chapter" data-level="4.3.1" data-path="population-mean-cosinor.html"><a href="population-mean-cosinor.html#confidence-intervals-for-population-cosinor"><i class="fa fa-check"></i><b>4.3.1</b> Confidence Intervals for Population Cosinor</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="multiple-component-cosinor.html"><a href="multiple-component-cosinor.html"><i class="fa fa-check"></i><b>4.4</b> Multiple-Component Cosinor</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="heart.html"><a href="heart.html"><i class="fa fa-check"></i><b>5</b> Heart</a><ul>
<li class="chapter" data-level="5.1" data-path="using-s4.html"><a href="using-s4.html"><i class="fa fa-check"></i><b>5.1</b> Using S4</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="package.html"><a href="package.html"><i class="fa fa-check"></i><b>6</b> Package Development</a><ul>
<li class="chapter" data-level="6.1" data-path="documenting-a-package.html"><a href="documenting-a-package.html"><i class="fa fa-check"></i><b>6.1</b> Documenting a Package</a><ul>
<li class="chapter" data-level="6.1.1" data-path="documenting-a-package.html"><a href="documenting-a-package.html#website"><i class="fa fa-check"></i><b>6.1.1</b> Website</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="building-a-modeling-package.html"><a href="building-a-modeling-package.html"><i class="fa fa-check"></i><b>6.2</b> Building a Modeling Package</a><ul>
<li class="chapter" data-level="6.2.1" data-path="building-a-modeling-package.html"><a href="building-a-modeling-package.html#blueprints"><i class="fa fa-check"></i><b>6.2.1</b> Blueprints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>7</b> Functions</a><ul>
<li class="chapter" data-level="7.1" data-path="speed-of-for-loops.html"><a href="speed-of-for-loops.html"><i class="fa fa-check"></i><b>7.1</b> Speed of <em>for loops</em></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="models.html"><a href="models.html"><i class="fa fa-check"></i><b>8</b> Modeling</a><ul>
<li class="chapter" data-level="8.1" data-path="modeling-multiple-outcomes-and-predictors.html"><a href="modeling-multiple-outcomes-and-predictors.html"><i class="fa fa-check"></i><b>8.1</b> Modeling Multiple Outcomes and Predictors</a><ul>
<li class="chapter" data-level="8.1.1" data-path="modeling-multiple-outcomes-and-predictors.html"><a href="modeling-multiple-outcomes-and-predictors.html#creating-multiple-models"><i class="fa fa-check"></i><b>8.1.1</b> Creating Multiple Models</a></li>
<li class="chapter" data-level="8.1.2" data-path="modeling-multiple-outcomes-and-predictors.html"><a href="modeling-multiple-outcomes-and-predictors.html#visualize-regression-estimates"><i class="fa fa-check"></i><b>8.1.2</b> Visualize Regression Estimates</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Electrocardiography</b></span></li>
<li class="chapter" data-level="9" data-path="vcg.html"><a href="vcg.html"><i class="fa fa-check"></i><b>9</b> Vectorcardiography</a><ul>
<li class="chapter" data-level="9.1" data-path="vector-gradients.html"><a href="vector-gradients.html"><i class="fa fa-check"></i><b>9.1</b> Vector Gradients</a></li>
<li class="chapter" data-level="9.2" data-path="global-electrical-heterogeneity.html"><a href="global-electrical-heterogeneity.html"><i class="fa fa-check"></i><b>9.2</b> Global Electrical Heterogeneity</a></li>
</ul></li>
<li class="part"><span><b>IV Clinical</b></span></li>
<li class="chapter" data-level="10" data-path="cardiac-catheterization.html"><a href="cardiac-catheterization.html"><i class="fa fa-check"></i><b>10</b> Cardiac Catheterization</a><ul>
<li class="chapter" data-level="10.1" data-path="right-heart-catheterization.html"><a href="right-heart-catheterization.html"><i class="fa fa-check"></i><b>10.1</b> Right heart catheterization</a></li>
<li class="chapter" data-level="10.2" data-path="invasive-hemodynamics.html"><a href="invasive-hemodynamics.html"><i class="fa fa-check"></i><b>10.2</b> Invasive Hemodynamics</a><ul>
<li class="chapter" data-level="10.2.1" data-path="invasive-hemodynamics.html"><a href="invasive-hemodynamics.html#ficks-cardiac-output"><i class="fa fa-check"></i><b>10.2.1</b> Fick’s cardiac output</a></li>
<li class="chapter" data-level="10.2.2" data-path="invasive-hemodynamics.html"><a href="invasive-hemodynamics.html#thermodilution"><i class="fa fa-check"></i><b>10.2.2</b> Thermodilution</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="coronary-anatomy.html"><a href="coronary-anatomy.html"><i class="fa fa-check"></i><b>10.3</b> Coronary Anatomy</a><ul>
<li class="chapter" data-level="10.3.1" data-path="coronary-anatomy.html"><a href="coronary-anatomy.html#text-processing"><i class="fa fa-check"></i><b>10.3.1</b> Text-processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="echo.html"><a href="echo.html"><i class="fa fa-check"></i><b>11</b> Echocardiography</a><ul>
<li class="chapter" data-level="11.1" data-path="chamber-size.html"><a href="chamber-size.html"><i class="fa fa-check"></i><b>11.1</b> Chamber size</a></li>
<li class="chapter" data-level="11.2" data-path="pressure-gradients.html"><a href="pressure-gradients.html"><i class="fa fa-check"></i><b>11.2</b> Pressure gradients</a></li>
</ul></li>
<li class="part"><span><b>V Learning</b></span></li>
<li class="chapter" data-level="12" data-path="tidymodels.html"><a href="tidymodels.html"><i class="fa fa-check"></i><b>12</b> Tidymodels</a><ul>
<li class="chapter" data-level="12.1" data-path="rmedicine-2020-and-rstudio-intro-course.html"><a href="rmedicine-2020-and-rstudio-intro-course.html"><i class="fa fa-check"></i><b>12.1</b> R/Medicine 2020 (and RStudio Intro Course)</a><ul>
<li class="chapter" data-level="12.1.1" data-path="rmedicine-2020-and-rstudio-intro-course.html"><a href="rmedicine-2020-and-rstudio-intro-course.html#introduction"><i class="fa fa-check"></i><b>12.1.1</b> Introduction</a></li>
<li class="chapter" data-level="12.1.2" data-path="rmedicine-2020-and-rstudio-intro-course.html"><a href="rmedicine-2020-and-rstudio-intro-course.html#build-a-model"><i class="fa fa-check"></i><b>12.1.2</b> Build a Model</a></li>
<li class="chapter" data-level="12.1.3" data-path="rmedicine-2020-and-rstudio-intro-course.html"><a href="rmedicine-2020-and-rstudio-intro-course.html#build-a-workflow"><i class="fa fa-check"></i><b>12.1.3</b> Build a Workflow</a></li>
<li class="chapter" data-level="12.1.4" data-path="rmedicine-2020-and-rstudio-intro-course.html"><a href="rmedicine-2020-and-rstudio-intro-course.html#tune-better-models"><i class="fa fa-check"></i><b>12.1.4</b> Tune Better Models</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Thoughts</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="population-mean-cosinor" class="section level2">
<h2><span class="header-section-number">4.3</span> Population-mean cosinor</h2>
<p>Based on the work by Cornelissen et al 2014 <span class="citation">(Cornelissen <a href="#ref-Cornelissen2014" role="doc-biblioref">2014</a>)</span>, the population mean cosinor can be estimated by applying the single or multiple component cosinor to each individual.</p>
<p><span class="math display">\[\{\hat{u} = \hat{M}_{i} + \hat\beta_{i} + \hat\gamma_{i} + ... \}\]</span></p>
<p>Where <span class="math inline">\(i = 1, 2, ..., k\)</span> for each individual contribution to the population cosinor metrics.</p>
<p>Each parameter can then be “averaged” to estimate the population parameters. This allows extension from a single individual to populations, particularly research studies with cohorts of patients.</p>
<p>The <span class="math inline">\(A\)</span> and <span class="math inline">\(\phi\)</span> however are calculated using the previous equations but through the <span class="math inline">\(\mu_{\beta}\)</span> and <span class="math inline">\(\mu_{\gamma}\)</span> values. The <em>MESOR</em> can be calculated simply by measure the mean value from each sample (<span class="math inline">\(MESOR_{population} = MESOR_{1} + ... + MESOR_{k}\)</span>).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="population-mean-cosinor.html#cb19-1"></a><span class="co"># Parameters for population mean cosinor, using best datasets</span></span>
<span id="cb19-2"><a href="population-mean-cosinor.html#cb19-2"></a>df &lt;-<span class="st"> </span>twins <span class="op">%&gt;%</span></span>
<span id="cb19-3"><a href="population-mean-cosinor.html#cb19-3"></a><span class="st">    </span><span class="kw">filter</span>(med_beta_blockers <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb19-4"><a href="population-mean-cosinor.html#cb19-4"></a><span class="st">    </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;rDYX&quot;</span>, <span class="st">&quot;hour&quot;</span>, <span class="st">&quot;patid&quot;</span>))</span>
<span id="cb19-5"><a href="population-mean-cosinor.html#cb19-5"></a><span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;pop&quot;</span>)</span>
<span id="cb19-6"><a href="population-mean-cosinor.html#cb19-6"></a>highCounts &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb19-7"><a href="population-mean-cosinor.html#cb19-7"></a><span class="st">    </span><span class="kw">group_by</span>(pop) <span class="op">%&gt;%</span></span>
<span id="cb19-8"><a href="population-mean-cosinor.html#cb19-8"></a><span class="st">    </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></span>
<span id="cb19-9"><a href="population-mean-cosinor.html#cb19-9"></a><span class="st">    </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>)</span>
<span id="cb19-10"><a href="population-mean-cosinor.html#cb19-10"></a></span>
<span id="cb19-11"><a href="population-mean-cosinor.html#cb19-11"></a><span class="co"># Subset for full data</span></span>
<span id="cb19-12"><a href="population-mean-cosinor.html#cb19-12"></a>df &lt;-<span class="st"> </span><span class="kw">subset</span>(df, pop <span class="op">%in%</span><span class="st"> </span>highCounts<span class="op">$</span>pop)</span>
<span id="cb19-13"><a href="population-mean-cosinor.html#cb19-13"></a></span>
<span id="cb19-14"><a href="population-mean-cosinor.html#cb19-14"></a><span class="co"># Number of individuals</span></span>
<span id="cb19-15"><a href="population-mean-cosinor.html#cb19-15"></a>k &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>pop))</span>
<span id="cb19-16"><a href="population-mean-cosinor.html#cb19-16"></a></span>
<span id="cb19-17"><a href="population-mean-cosinor.html#cb19-17"></a><span class="co"># Individual cosinor models are implemented for each individual</span></span>
<span id="cb19-18"><a href="population-mean-cosinor.html#cb19-18"></a>kCosinors &lt;-<span class="st"> </span></span>
<span id="cb19-19"><a href="population-mean-cosinor.html#cb19-19"></a><span class="st">    </span><span class="kw">with</span>(</span>
<span id="cb19-20"><a href="population-mean-cosinor.html#cb19-20"></a>        df,</span>
<span id="cb19-21"><a href="population-mean-cosinor.html#cb19-21"></a>        <span class="kw">by</span>(df, pop, <span class="cf">function</span>(x) {</span>
<span id="cb19-22"><a href="population-mean-cosinor.html#cb19-22"></a>            <span class="kw">cosinor</span>(y <span class="op">~</span><span class="st"> </span>t, <span class="dt">data =</span> x, <span class="dt">tau =</span> <span class="dv">24</span>)</span>
<span id="cb19-23"><a href="population-mean-cosinor.html#cb19-23"></a>        })</span>
<span id="cb19-24"><a href="population-mean-cosinor.html#cb19-24"></a>    )</span>
<span id="cb19-25"><a href="population-mean-cosinor.html#cb19-25"></a></span>
<span id="cb19-26"><a href="population-mean-cosinor.html#cb19-26"></a><span class="co"># The coefficients have to be extracted and summarized</span></span>
<span id="cb19-27"><a href="population-mean-cosinor.html#cb19-27"></a>tbl &lt;-<span class="st"> </span><span class="kw">sapply</span>(kCosinors, stats<span class="op">::</span>coef)</span>
<span id="cb19-28"><a href="population-mean-cosinor.html#cb19-28"></a>coef_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;mesor&quot;</span>, <span class="st">&quot;amp&quot;</span>, <span class="st">&quot;phi&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb19-29"><a href="population-mean-cosinor.html#cb19-29"></a><span class="kw">rownames</span>(tbl) &lt;-<span class="st"> </span>coef_names</span>
<span id="cb19-30"><a href="population-mean-cosinor.html#cb19-30"></a>xmat &lt;-<span class="st"> </span><span class="kw">t</span>(tbl)</span>
<span id="cb19-31"><a href="population-mean-cosinor.html#cb19-31"></a></span>
<span id="cb19-32"><a href="population-mean-cosinor.html#cb19-32"></a><span class="co"># Get mean for each parameter (mesor, beta, gamma), ignoring averaged amp/phi</span></span>
<span id="cb19-33"><a href="population-mean-cosinor.html#cb19-33"></a>coefs &lt;-<span class="st"> </span><span class="kw">apply</span>(xmat, <span class="dt">MARGIN =</span> <span class="dv">2</span>, <span class="cf">function</span>(x) {</span>
<span id="cb19-34"><a href="population-mean-cosinor.html#cb19-34"></a>  <span class="kw">sum</span>(x) <span class="op">/</span><span class="st"> </span>k</span>
<span id="cb19-35"><a href="population-mean-cosinor.html#cb19-35"></a>})</span>
<span id="cb19-36"><a href="population-mean-cosinor.html#cb19-36"></a></span>
<span id="cb19-37"><a href="population-mean-cosinor.html#cb19-37"></a>mesor &lt;-<span class="st"> </span><span class="kw">unname</span>(coefs[<span class="st">&quot;mesor&quot;</span>])</span>
<span id="cb19-38"><a href="population-mean-cosinor.html#cb19-38"></a>beta &lt;-<span class="st"> </span><span class="kw">unname</span>(coefs[<span class="st">&quot;beta&quot;</span>])</span>
<span id="cb19-39"><a href="population-mean-cosinor.html#cb19-39"></a>gamma &lt;-<span class="st"> </span><span class="kw">unname</span>(coefs[<span class="st">&quot;gamma&quot;</span>])</span>
<span id="cb19-40"><a href="population-mean-cosinor.html#cb19-40"></a></span>
<span id="cb19-41"><a href="population-mean-cosinor.html#cb19-41"></a><span class="co"># Get amplitude</span></span>
<span id="cb19-42"><a href="population-mean-cosinor.html#cb19-42"></a>amp &lt;-<span class="st"> </span><span class="kw">sqrt</span>(beta<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>gamma<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb19-43"><a href="population-mean-cosinor.html#cb19-43"></a></span>
<span id="cb19-44"><a href="population-mean-cosinor.html#cb19-44"></a><span class="co"># Acrophase (phi) must be in correct quadrant</span></span>
<span id="cb19-45"><a href="population-mean-cosinor.html#cb19-45"></a>sb &lt;-<span class="st"> </span><span class="kw">sign</span>(beta)</span>
<span id="cb19-46"><a href="population-mean-cosinor.html#cb19-46"></a>sg &lt;-<span class="st"> </span><span class="kw">sign</span>(gamma)</span>
<span id="cb19-47"><a href="population-mean-cosinor.html#cb19-47"></a>theta &lt;-<span class="st"> </span><span class="kw">atan</span>(<span class="kw">abs</span>(gamma <span class="op">/</span><span class="st"> </span>beta))</span>
<span id="cb19-48"><a href="population-mean-cosinor.html#cb19-48"></a></span>
<span id="cb19-49"><a href="population-mean-cosinor.html#cb19-49"></a><span class="cf">if</span> ((sb <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sb <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&amp;</span><span class="st"> </span>sg <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb19-50"><a href="population-mean-cosinor.html#cb19-50"></a>  phi &lt;-<span class="st"> </span><span class="op">-</span>theta</span>
<span id="cb19-51"><a href="population-mean-cosinor.html#cb19-51"></a>} <span class="cf">else</span> <span class="cf">if</span> (sb <span class="op">==</span><span class="st"> </span><span class="dv">-1</span> <span class="op">&amp;</span><span class="st"> </span>(sg <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>sg <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) {</span>
<span id="cb19-52"><a href="population-mean-cosinor.html#cb19-52"></a>  phi &lt;-<span class="st"> </span>theta <span class="op">-</span><span class="st"> </span>pi</span>
<span id="cb19-53"><a href="population-mean-cosinor.html#cb19-53"></a>} <span class="cf">else</span> <span class="cf">if</span> ((sb <span class="op">==</span><span class="st"> </span><span class="dv">-1</span> <span class="op">|</span><span class="st"> </span>sb <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">&amp;</span><span class="st"> </span>sg <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>) {</span>
<span id="cb19-54"><a href="population-mean-cosinor.html#cb19-54"></a>  phi &lt;-<span class="st"> </span><span class="op">-</span>theta <span class="op">-</span><span class="st"> </span>pi</span>
<span id="cb19-55"><a href="population-mean-cosinor.html#cb19-55"></a>} <span class="cf">else</span> <span class="cf">if</span> (sb <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>(sg <span class="op">==</span><span class="st"> </span><span class="dv">-1</span> <span class="op">|</span><span class="st"> </span>sg <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) {</span>
<span id="cb19-56"><a href="population-mean-cosinor.html#cb19-56"></a>  phi &lt;-<span class="st"> </span>theta <span class="op">-</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)</span>
<span id="cb19-57"><a href="population-mean-cosinor.html#cb19-57"></a>}</span>
<span id="cb19-58"><a href="population-mean-cosinor.html#cb19-58"></a></span>
<span id="cb19-59"><a href="population-mean-cosinor.html#cb19-59"></a><span class="co"># Update coefficients</span></span>
<span id="cb19-60"><a href="population-mean-cosinor.html#cb19-60"></a>coefs[<span class="st">&quot;amp&quot;</span>] &lt;-<span class="st"> </span>amp</span>
<span id="cb19-61"><a href="population-mean-cosinor.html#cb19-61"></a>coefs[<span class="st">&quot;phi&quot;</span>] &lt;-<span class="st"> </span>phi</span>
<span id="cb19-62"><a href="population-mean-cosinor.html#cb19-62"></a></span>
<span id="cb19-63"><a href="population-mean-cosinor.html#cb19-63"></a><span class="co"># Updated coefficients</span></span>
<span id="cb19-64"><a href="population-mean-cosinor.html#cb19-64"></a><span class="kw">names</span>(coefs) &lt;-<span class="st"> </span>coef_names</span>
<span id="cb19-65"><a href="population-mean-cosinor.html#cb19-65"></a><span class="kw">print</span>(coefs)</span></code></pre></div>
<pre><code>##      mesor        amp        phi       beta      gamma 
##  2.9020896  0.3144840 -2.6948505 -0.2836203  0.1358664</code></pre>
<div id="confidence-intervals-for-population-cosinor" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Confidence Intervals for Population Cosinor</h3>
<p>The confidence intervals for a population are more complicated to generate, and several approaches are documented in the literature.</p>
<div id="ellipsoid-approach" class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> Ellipsoid Approach</h4>
<p>The values, including standard deviation and standard error for the <em>MESOR</em> are calculated using standard statistics along a t-distribution, with degree of freedom based on number of observations. In this case, <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="population-mean-cosinor.html#cb21-1"></a><span class="co"># Standard error for mesor</span></span>
<span id="cb21-2"><a href="population-mean-cosinor.html#cb21-2"></a>kcoefs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(xmat)</span>
<span id="cb21-3"><a href="population-mean-cosinor.html#cb21-3"></a>se &lt;-<span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>mesor) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb21-4"><a href="population-mean-cosinor.html#cb21-4"></a><span class="kw">cat</span>(<span class="kw">round</span>(se, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## 0.022</code></pre>
<p>The statistical parameters around the <span class="math inline">\(A\)</span> and <span class="math inline">\(\phi\)</span> are more complex, as they are joined together, and represent a joint confidence region of the substitute parameters <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span>.</p>
<p>The first step is the calculation of the variance and covariance of <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span>. This can be used to generated teh standard deviation of these variables.</p>
<p><span class="math display">\[
\begin{aligned}
\sigma_{\beta \gamma} &amp;= \sqrt{COV_{\beta \gamma}} \\
\sigma_{\beta} &amp;= \sqrt{VAR_{\beta}} \\
\sigma_{\gamma} &amp;= \sqrt{VAR_{\gamma}} \\
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="population-mean-cosinor.html#cb23-1"></a>sbg &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">cov</span>(kcoefs<span class="op">$</span>beta, kcoefs<span class="op">$</span>gamma))</span>
<span id="cb23-2"><a href="population-mean-cosinor.html#cb23-2"></a>sb &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(kcoefs<span class="op">$</span>beta))</span>
<span id="cb23-3"><a href="population-mean-cosinor.html#cb23-3"></a>sg &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(kcoefs<span class="op">$</span>gamma))</span></code></pre></div>
<p>The next step is the creation of a confidence ellipse for a given confidence interval. This ellipse is defined by all points <span class="math inline">\((\beta*, \gamma*)\)</span> that satisfy the elliptical equation.</p>
<p><span class="math display">\[
\frac{(\beta - \beta*)^2}{\sigma^2_{\beta}} -
\frac{2r(\beta - \beta*)(\gamma - \gamma*)}{\sigma_{\beta} \sigma_{\gamma}} +
\frac{(\gamma - \gamma*)}{\sigma^2_{\gamma}} = 
\frac{2(1 - r^2)(k - 1)F_{1 - \alpha}}{k(k - 2)}
\]</span></p>
<p>This can be reorganized/reorderd by solving for a single parameter first, such as <span class="math inline">\(\beta*\)</span>, which will lead to two potential values.</p>
<p><span class="math display">\[
\beta* = 
\frac{
    \beta \sigma_{\gamma} - r \sigma_{beta} \gamma + r \sigma_{beta} \gamma* \pm
    \sqrt{(r^2 - 1)[(\gamma* - \gamma)^2 - \frac{2(k-1)}{k(k-2)}F_{1-\alpha}\sigma^2_{\gamma}]}
}
{\sigma_{\gamma}}
\]</span></p>
<p>… where <span class="math inline">\(r = \frac{\sigma_{\beta \gamma}}{\sigma_{\beta} \sigma_{\gamma}}\)</span></p>
<p>This is calculated using the above equation for a potential sequence of values of <span class="math inline">\(\beta*\)</span> and <span class="math inline">\(\gamma*\)</span>. THe constant values are already known to us, including the <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> variables.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="population-mean-cosinor.html#cb24-1"></a><span class="co"># Variance/covariance and initial values were found above</span></span>
<span id="cb24-2"><a href="population-mean-cosinor.html#cb24-2"></a><span class="co"># Define new constants</span></span>
<span id="cb24-3"><a href="population-mean-cosinor.html#cb24-3"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></span>
<span id="cb24-4"><a href="population-mean-cosinor.html#cb24-4"></a>r &lt;-<span class="st"> </span>sbg <span class="op">/</span><span class="st"> </span>(sb <span class="op">*</span><span class="st"> </span>sg)</span>
<span id="cb24-5"><a href="population-mean-cosinor.html#cb24-5"></a>fstat &lt;-<span class="st"> </span><span class="kw">qf</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha, <span class="dv">2</span>, k <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)</span>
<span id="cb24-6"><a href="population-mean-cosinor.html#cb24-6"></a></span>
<span id="cb24-7"><a href="population-mean-cosinor.html#cb24-7"></a><span class="co"># Sequence values</span></span>
<span id="cb24-8"><a href="population-mean-cosinor.html#cb24-8"></a>gseq &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="op">-</span><span class="kw">abs</span>(gamma<span class="op">*</span><span class="dv">3</span>), <span class="dt">to =</span> <span class="kw">abs</span>(gamma<span class="op">*</span><span class="dv">3</span>), <span class="dt">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb24-9"><a href="population-mean-cosinor.html#cb24-9"></a>bpos &lt;-<span class="st"> </span>((beta <span class="op">*</span><span class="st"> </span>sg) <span class="op">-</span><span class="st"> </span>(r <span class="op">*</span><span class="st"> </span>sb <span class="op">*</span><span class="st"> </span>gamma) <span class="op">+</span><span class="st"> </span>(r <span class="op">*</span><span class="st"> </span>sb <span class="op">*</span><span class="st"> </span>gseq) <span class="op">+</span><span class="st"> </span>(sb <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">as.complex</span>((r<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>((gseq <span class="op">-</span><span class="st"> </span>gamma)<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>((<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>fstat <span class="op">*</span><span class="st"> </span>sg<span class="op">^</span><span class="dv">2</span>)))))) <span class="op">/</span><span class="st"> </span>sg</span>
<span id="cb24-10"><a href="population-mean-cosinor.html#cb24-10"></a>bneg &lt;-<span class="st"> </span>((beta <span class="op">*</span><span class="st"> </span>sg) <span class="op">-</span><span class="st"> </span>(r <span class="op">*</span><span class="st"> </span>sb <span class="op">*</span><span class="st"> </span>gamma) <span class="op">+</span><span class="st"> </span>(r <span class="op">*</span><span class="st"> </span>sb <span class="op">*</span><span class="st"> </span>gseq) <span class="op">-</span><span class="st"> </span>(sb <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">as.complex</span>((r<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>((gseq <span class="op">-</span><span class="st"> </span>gamma)<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>((<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">*</span><span class="st"> </span>fstat <span class="op">*</span><span class="st"> </span>sg<span class="op">^</span><span class="dv">2</span>)))))) <span class="op">/</span><span class="st"> </span>sg</span>
<span id="cb24-11"><a href="population-mean-cosinor.html#cb24-11"></a></span>
<span id="cb24-12"><a href="population-mean-cosinor.html#cb24-12"></a><span class="co"># Restrict to only real numbers (not complex/imaginary)</span></span>
<span id="cb24-13"><a href="population-mean-cosinor.html#cb24-13"></a>index &lt;-<span class="st"> </span><span class="kw">Im</span>(bpos) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">Im</span>(bpos) <span class="op">==</span><span class="st"> </span><span class="kw">Im</span>(bneg) <span class="co"># values are zero in both are REAL numbers</span></span>
<span id="cb24-14"><a href="population-mean-cosinor.html#cb24-14"></a>gseq &lt;-<span class="st"> </span><span class="kw">Re</span>(gseq[index])</span>
<span id="cb24-15"><a href="population-mean-cosinor.html#cb24-15"></a>bpos &lt;-<span class="st"> </span><span class="kw">Re</span>(bpos[index])</span>
<span id="cb24-16"><a href="population-mean-cosinor.html#cb24-16"></a>bneg &lt;-<span class="st"> </span><span class="kw">Re</span>(bneg[index])</span>
<span id="cb24-17"><a href="population-mean-cosinor.html#cb24-17"></a></span>
<span id="cb24-18"><a href="population-mean-cosinor.html#cb24-18"></a></span>
<span id="cb24-19"><a href="population-mean-cosinor.html#cb24-19"></a><span class="co"># Plot out ellipse </span></span>
<span id="cb24-20"><a href="population-mean-cosinor.html#cb24-20"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-21"><a href="population-mean-cosinor.html#cb24-21"></a><span class="st">    </span><span class="co"># Original values</span></span>
<span id="cb24-22"><a href="population-mean-cosinor.html#cb24-22"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gamma, <span class="dt">y =</span> beta), <span class="dt">data =</span> kcoefs, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-23"><a href="population-mean-cosinor.html#cb24-23"></a><span class="st">    </span><span class="co"># Potential ellipse versus hyperbola</span></span>
<span id="cb24-24"><a href="population-mean-cosinor.html#cb24-24"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gseq, <span class="dt">y =</span> bpos), <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-25"><a href="population-mean-cosinor.html#cb24-25"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gseq, <span class="dt">y =</span> bneg), <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-26"><a href="population-mean-cosinor.html#cb24-26"></a><span class="st">    </span><span class="co"># Predicted segment</span></span>
<span id="cb24-27"><a href="population-mean-cosinor.html#cb24-27"></a><span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>, <span class="dt">xend =</span> <span class="op">-</span>amp<span class="op">*</span><span class="kw">sin</span>(phi), <span class="dt">yend =</span> amp<span class="op">*</span><span class="kw">cos</span>(phi)), <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-28"><a href="population-mean-cosinor.html#cb24-28"></a><span class="st">    </span><span class="co"># Axes</span></span>
<span id="cb24-29"><a href="population-mean-cosinor.html#cb24-29"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-30"><a href="population-mean-cosinor.html#cb24-30"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb24-31"><a href="population-mean-cosinor.html#cb24-31"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="op">-</span><span class="kw">abs</span>(gamma)<span class="op">*</span><span class="dv">5</span>, <span class="kw">abs</span>(gamma)<span class="op">*</span><span class="dv">5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-32"><a href="population-mean-cosinor.html#cb24-32"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="op">-</span><span class="kw">abs</span>(beta)<span class="op">*</span><span class="dv">5</span>, <span class="kw">abs</span>(beta)<span class="op">*</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 7 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 33 rows containing missing values (geom_point).</code></pre>
<p><img src="thoughts_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="population-mean-cosinor.html#cb27-1"></a><span class="co"># Using {car}</span></span>
<span id="cb27-2"><a href="population-mean-cosinor.html#cb27-2"></a>border &lt;-<span class="st"> </span>car<span class="op">::</span><span class="kw">dataEllipse</span>(<span class="kw">cbind</span>(kcoefs<span class="op">$</span>gamma, kcoefs<span class="op">$</span>beta), <span class="dt">levels =</span> <span class="fl">0.95</span>) <span class="op">%&gt;%</span></span>
<span id="cb27-3"><a href="population-mean-cosinor.html#cb27-3"></a><span class="st">    </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<p><img src="thoughts_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="population-mean-cosinor.html#cb28-1"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb28-2"><a href="population-mean-cosinor.html#cb28-2"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y), <span class="dt">data =</span> border, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb28-3"><a href="population-mean-cosinor.html#cb28-3"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gamma, <span class="dt">y =</span> beta), <span class="dt">data =</span> kcoefs, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb28-4"><a href="population-mean-cosinor.html#cb28-4"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb28-5"><a href="population-mean-cosinor.html#cb28-5"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) </span></code></pre></div>
<p><img src="thoughts_files/figure-html/unnamed-chunk-9-3.png" width="672" /></p>
</div>
<div id="sampling-matrix-approach" class="section level4">
<h4><span class="header-section-number">4.3.1.2</span> Sampling Matrix Approach</h4>
<p>An approach, according to <em>Bingham et al 1982</em>, is to use the sampling matrix, generated from the following formulas and calculated below. The key formulas for the population cosinor confidence intervals are:</p>
<p>$$
\begin{aligned}</p>
<p>MESOR &amp; \</p>
<p>A &amp;t_{1 - /2}  \</p>
<p>&amp;+ arctan()</p>
<p>\end{aligned}
$$</p>
<p>Where the matrix variables are shown below:</p>
<p>$$
\begin{aligned}
s_{22} &amp;=  \</p>
<p>s_{23} &amp;=  \</p>
<p>s_{33} &amp;= </p>
<p>\end{aligned}
$$</p>
<p>Thus, we can use these equations to calculate the confidence intervals.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="population-mean-cosinor.html#cb29-1"></a><span class="co"># Stats</span></span>
<span id="cb29-2"><a href="population-mean-cosinor.html#cb29-2"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></span>
<span id="cb29-3"><a href="population-mean-cosinor.html#cb29-3"></a>tdist &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha<span class="op">/</span><span class="dv">2</span>, k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb29-4"><a href="population-mean-cosinor.html#cb29-4"></a></span>
<span id="cb29-5"><a href="population-mean-cosinor.html#cb29-5"></a><span class="co"># Matrix variables</span></span>
<span id="cb29-6"><a href="population-mean-cosinor.html#cb29-6"></a>s22 &lt;-<span class="st"> </span>((sb<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>beta<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sbg <span class="op">*</span><span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>gamma) <span class="op">+</span><span class="st"> </span>(sg<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>gamma<span class="op">^</span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>amp<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb29-7"><a href="population-mean-cosinor.html#cb29-7"></a>s23 &lt;-<span class="st"> </span>(<span class="op">-</span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(sb<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>sg<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(beta <span class="op">*</span><span class="st"> </span>gamma) <span class="op">+</span><span class="st"> </span>sbg <span class="op">*</span><span class="st"> </span>(beta<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>gamma<span class="op">^</span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>amp<span class="op">^</span><span class="dv">2</span>)</span>
<span id="cb29-8"><a href="population-mean-cosinor.html#cb29-8"></a>s33 &lt;-<span class="st"> </span>((sb<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>gamma<span class="op">^</span><span class="dv">2</span>) <span class="op">-</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sbg <span class="op">*</span><span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>gamma) <span class="op">+</span><span class="st"> </span>(sg<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>beta<span class="op">^</span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>(k <span class="op">*</span><span class="st"> </span>amp<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="approach-by-fernandez-fernandez2004" class="section level4">
<h4><span class="header-section-number">4.3.1.3</span> Approach by Fernandez <span class="citation">(Fernández, Mojón, and Hermida <a href="#ref-Fernandez2004" role="doc-biblioref">2004</a>)</span></h4>
<p>The population aproach can also be predicted through an alternative, perhaps more intuitive way. If normality is assumed, the estimated parameters can be generated from the individual parameters, similar to the <em>MESOR</em>, in a single population, and allows for simple statistical testing between populations. <span class="citation">(Fernández, Mojón, and Hermida <a href="#ref-Fernandez2004" role="doc-biblioref">2004</a>)</span></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="population-mean-cosinor.html#cb30-1"></a><span class="co"># Stats</span></span>
<span id="cb30-2"><a href="population-mean-cosinor.html#cb30-2"></a>kcoefs &lt;-<span class="st"> </span><span class="kw">data.frame</span>(xmat)</span>
<span id="cb30-3"><a href="population-mean-cosinor.html#cb30-3"></a>alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></span>
<span id="cb30-4"><a href="population-mean-cosinor.html#cb30-4"></a>tdist &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha<span class="op">/</span><span class="dv">2</span>, k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb30-5"><a href="population-mean-cosinor.html#cb30-5"></a></span>
<span id="cb30-6"><a href="population-mean-cosinor.html#cb30-6"></a><span class="co"># Plot</span></span>
<span id="cb30-7"><a href="population-mean-cosinor.html#cb30-7"></a>g &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb30-8"><a href="population-mean-cosinor.html#cb30-8"></a><span class="st">    </span><span class="kw">geom_segment</span>(</span>
<span id="cb30-9"><a href="population-mean-cosinor.html#cb30-9"></a>        <span class="kw">aes</span>(</span>
<span id="cb30-10"><a href="population-mean-cosinor.html#cb30-10"></a>            <span class="dt">x =</span> gamma <span class="op">-</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-11"><a href="population-mean-cosinor.html#cb30-11"></a>            <span class="dt">xend =</span> gamma <span class="op">+</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-12"><a href="population-mean-cosinor.html#cb30-12"></a>            <span class="dt">y =</span> <span class="dv">0</span>,</span>
<span id="cb30-13"><a href="population-mean-cosinor.html#cb30-13"></a>            <span class="dt">yend =</span> <span class="dv">0</span></span>
<span id="cb30-14"><a href="population-mean-cosinor.html#cb30-14"></a>        ),</span>
<span id="cb30-15"><a href="population-mean-cosinor.html#cb30-15"></a>        <span class="dt">col =</span> <span class="st">&quot;cornflowerblue&quot;</span>,</span>
<span id="cb30-16"><a href="population-mean-cosinor.html#cb30-16"></a>        <span class="dt">size =</span> <span class="dv">2</span></span>
<span id="cb30-17"><a href="population-mean-cosinor.html#cb30-17"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-18"><a href="population-mean-cosinor.html#cb30-18"></a><span class="st">    </span><span class="kw">geom_segment</span>(</span>
<span id="cb30-19"><a href="population-mean-cosinor.html#cb30-19"></a>        <span class="kw">aes</span>(</span>
<span id="cb30-20"><a href="population-mean-cosinor.html#cb30-20"></a>            <span class="dt">y =</span> beta <span class="op">-</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-21"><a href="population-mean-cosinor.html#cb30-21"></a>            <span class="dt">yend =</span> beta <span class="op">+</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-22"><a href="population-mean-cosinor.html#cb30-22"></a>            <span class="dt">x =</span> <span class="dv">0</span>,</span>
<span id="cb30-23"><a href="population-mean-cosinor.html#cb30-23"></a>            <span class="dt">xend =</span> <span class="dv">0</span></span>
<span id="cb30-24"><a href="population-mean-cosinor.html#cb30-24"></a>        ),</span>
<span id="cb30-25"><a href="population-mean-cosinor.html#cb30-25"></a>        <span class="dt">col =</span> <span class="st">&quot;indianred&quot;</span>,</span>
<span id="cb30-26"><a href="population-mean-cosinor.html#cb30-26"></a>        <span class="dt">size =</span> <span class="dv">2</span></span>
<span id="cb30-27"><a href="population-mean-cosinor.html#cb30-27"></a>    ) <span class="op">+</span></span>
<span id="cb30-28"><a href="population-mean-cosinor.html#cb30-28"></a><span class="st">    </span><span class="kw">geom_rect</span>(</span>
<span id="cb30-29"><a href="population-mean-cosinor.html#cb30-29"></a>        <span class="kw">aes</span>(</span>
<span id="cb30-30"><a href="population-mean-cosinor.html#cb30-30"></a>            <span class="dt">ymin =</span> beta <span class="op">-</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-31"><a href="population-mean-cosinor.html#cb30-31"></a>            <span class="dt">ymax =</span> beta <span class="op">+</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-32"><a href="population-mean-cosinor.html#cb30-32"></a>            <span class="dt">xmin =</span> <span class="dv">0</span>,</span>
<span id="cb30-33"><a href="population-mean-cosinor.html#cb30-33"></a>            <span class="dt">xmax =</span> gamma <span class="op">+</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k))</span>
<span id="cb30-34"><a href="population-mean-cosinor.html#cb30-34"></a>        ),</span>
<span id="cb30-35"><a href="population-mean-cosinor.html#cb30-35"></a>        <span class="dt">fill =</span> <span class="st">&quot;indianred&quot;</span>,</span>
<span id="cb30-36"><a href="population-mean-cosinor.html#cb30-36"></a>        <span class="dt">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb30-37"><a href="population-mean-cosinor.html#cb30-37"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-38"><a href="population-mean-cosinor.html#cb30-38"></a><span class="st">    </span><span class="kw">geom_rect</span>( </span>
<span id="cb30-39"><a href="population-mean-cosinor.html#cb30-39"></a>        <span class="kw">aes</span>(</span>
<span id="cb30-40"><a href="population-mean-cosinor.html#cb30-40"></a>            <span class="dt">ymin =</span> <span class="dv">0</span>,</span>
<span id="cb30-41"><a href="population-mean-cosinor.html#cb30-41"></a>            <span class="dt">ymax =</span> beta <span class="op">-</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-42"><a href="population-mean-cosinor.html#cb30-42"></a>            <span class="dt">xmin =</span> gamma <span class="op">-</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k)),</span>
<span id="cb30-43"><a href="population-mean-cosinor.html#cb30-43"></a>            <span class="dt">xmax =</span> gamma <span class="op">+</span><span class="st"> </span>(tdist <span class="op">*</span><span class="st"> </span><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(k))</span>
<span id="cb30-44"><a href="population-mean-cosinor.html#cb30-44"></a>        ),</span>
<span id="cb30-45"><a href="population-mean-cosinor.html#cb30-45"></a>        <span class="dt">fill =</span> <span class="st">&quot;cornflowerblue&quot;</span>,</span>
<span id="cb30-46"><a href="population-mean-cosinor.html#cb30-46"></a>        <span class="dt">alpha =</span> <span class="fl">0.5</span></span>
<span id="cb30-47"><a href="population-mean-cosinor.html#cb30-47"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-48"><a href="population-mean-cosinor.html#cb30-48"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gamma, <span class="dt">y =</span> beta), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-49"><a href="population-mean-cosinor.html#cb30-49"></a><span class="st">    </span><span class="kw">geom_segment</span>(</span>
<span id="cb30-50"><a href="population-mean-cosinor.html#cb30-50"></a>        <span class="kw">aes</span>(</span>
<span id="cb30-51"><a href="population-mean-cosinor.html#cb30-51"></a>            <span class="dt">x =</span> <span class="dv">0</span>, </span>
<span id="cb30-52"><a href="population-mean-cosinor.html#cb30-52"></a>            <span class="dt">y =</span> <span class="dv">0</span>, </span>
<span id="cb30-53"><a href="population-mean-cosinor.html#cb30-53"></a>            <span class="dt">xend =</span> <span class="op">-</span>amp<span class="op">*</span><span class="kw">sin</span>(phi), </span>
<span id="cb30-54"><a href="population-mean-cosinor.html#cb30-54"></a>            <span class="dt">yend =</span> amp<span class="op">*</span><span class="kw">cos</span>(phi)</span>
<span id="cb30-55"><a href="population-mean-cosinor.html#cb30-55"></a>        ), </span>
<span id="cb30-56"><a href="population-mean-cosinor.html#cb30-56"></a>        <span class="dt">size =</span> <span class="fl">1.2</span></span>
<span id="cb30-57"><a href="population-mean-cosinor.html#cb30-57"></a>    ) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-58"><a href="population-mean-cosinor.html#cb30-58"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb30-59"><a href="population-mean-cosinor.html#cb30-59"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) </span>
<span id="cb30-60"><a href="population-mean-cosinor.html#cb30-60"></a>    </span>
<span id="cb30-61"><a href="population-mean-cosinor.html#cb30-61"></a><span class="co"># Values possible for amplitude</span></span>
<span id="cb30-62"><a href="population-mean-cosinor.html#cb30-62"></a><span class="kw">is.logical</span>(<span class="kw">round</span>(kcoefs<span class="op">$</span>amp <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(kcoefs<span class="op">$</span>phi), <span class="dv">3</span>) <span class="op">==</span><span class="st"> </span><span class="kw">round</span>(kcoefs<span class="op">$</span>beta, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="population-mean-cosinor.html#cb32-1"></a><span class="co"># Values for phi</span></span>
<span id="cb32-2"><a href="population-mean-cosinor.html#cb32-2"></a><span class="kw">is.logical</span>(<span class="kw">round</span>(kcoefs<span class="op">$</span>amp <span class="op">*</span><span class="st"> </span><span class="dv">-1</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(kcoefs<span class="op">$</span>phi), <span class="dv">3</span>) <span class="op">==</span><span class="st"> </span><span class="kw">round</span>(kcoefs<span class="op">$</span>gamma, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="population-mean-cosinor.html#cb34-1"></a><span class="kw">sd</span>(kcoefs<span class="op">$</span>beta)</span></code></pre></div>
<pre><code>## [1] 0.3023976</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="population-mean-cosinor.html#cb36-1"></a><span class="kw">sd</span>(kcoefs<span class="op">$</span>gamma)</span></code></pre></div>
<pre><code>## [1] 0.2376721</code></pre>
<p>However, this method is more complicated when multiple components are included.</p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Cornelissen2014">
<p>Cornelissen, Germaine. 2014. “Cosinor-based rhythmometry.” BioMed Central. <a href="https://doi.org/10.1186/1742-4682-11-16">https://doi.org/10.1186/1742-4682-11-16</a>.</p>
</div>
<div id="ref-Fernandez2004">
<p>Fernández, José Ramón, Artemio Mojón, and Ramón C Hermida. 2004. “Comparison of parameters from rhythmometric models with multiple components on hybrid data.” <em>Chronobiology International</em> 21 (3): 469–84. <a href="https://doi.org/10.1081/CBI-120038630">https://doi.org/10.1081/CBI-120038630</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="single-component-cosinor.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-component-cosinor.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["thoughts.pdf"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
